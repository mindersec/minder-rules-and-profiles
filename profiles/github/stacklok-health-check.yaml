---
# Stacklok health check profile.
version: v1
type: profile
name: stacklok-health-check
context:
  provider: github
alert: "off"
remediate: "off"
repository:
  # IMPORTANT: This needs to be paired with a rule
  # that checks that dependabot or renovate (or any other update tool)
  # is enabled.
  - type: actions_check_pinned_tags
    def:
      exclude:
        - slsa-framework/slsa-github-generator/.github/workflows/generator_generic_slsa3.yml@v1.9.0
  - type: branch_protection_allow_force_pushes
    def: 
      allow_force_pushes: false
    params:
      branch: main # TODO: make this dynamic
  - type: branch_protection_require_pull_request_dismiss_stale_reviews
    def:
      dismiss_stale_reviews: true
    params:
      branch: main # TODO: make this dynamic
  # TODO: Let's add this to a multi-contributor health check profile
  - type: branch_protection_require_pull_request_approving_review_count
    def:
      required_approving_review_count: 1
    params:
      branch: main # TODO: make this dynamic
  # TODO: Let's add this to a multi-contributor health check profile
  - type: branch_protection_require_pull_requests
    def:
      required_pull_request_reviews: true
    params:
      branch: main # TODO: make this dynamic
  - type: default_workflow_permissions
    def:
      default_workflow_permissions: read
      can_approve_pull_request_reviews: false
  # TODO: Add rule to check for dependabot or renovate being enabled
  - type: dockerfile_no_latest_tag
    def: {}
  - type: invisible_characters_check
    def: {}
  - type: mixed_scripts_check
    def: {}
  - type: secret_push_protection
    def:
      enabled: true
      skip_private_repos: true
  - type: "secret_scanning"
    def:
      enabled: true
      skip_private_repos: true
# TODO: Should we enable this?
# artifact:
#  - type: artifact_signature
#    params:
#      sigstore: tuf-repo-cdn.sigstore.dev
#    def:
#      is_signed: true
#      is_verified: true